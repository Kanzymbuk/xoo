<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>XO Arena Deluxe</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#6a00b8">

<style>
html,body{
  margin:0;padding:0;height:100%;
  font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
  display:flex;justify-content:center;align-items:center;
  background:#210034;color:#fff;overflow:hidden;
}
.container{max-width:420px;width:100%;padding:1rem;display:flex;flex-direction:column;gap:1rem;text-align:center}
.glass{backdrop-filter:blur(12px) saturate(180%);background:rgba(255,255,255,.12);border-radius:16px;padding:1rem;box-shadow:0 4px 30px rgba(0,0,0,.3)}
.title{font-size:1.8rem;font-weight:700}
.panel{
  display:flex;
  justify-content:space-between;
  gap:.5rem;
  flex-wrap:nowrap;
}
.panel .button{
  flex:1;
  text-align:center;
}
.button{padding:.4rem .8rem;border-radius:8px;border:none;font-weight:600;cursor:pointer}
.board{display:grid;grid-template-columns:repeat(3,1fr);gap:.5rem;position:relative}
.cell{aspect-ratio:1;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:2.4rem;font-weight:700;cursor:pointer;background:rgba(255,255,255,.12)}
.cell.x{color:#ff4ff6;text-shadow:0 0 12px #ff4ff6}
.cell.o{color:#00faff;text-shadow:0 0 12px #00faff}
.cell.win{box-shadow:0 0 15px 4px rgba(255,255,255,.8)}
#win-line {
  position: absolute;
  height: 4px;
  background: linear-gradient(
    90deg,
    rgba(255,255,255,0.2),
    rgba(255,255,255,1),
    rgba(255,255,255,0.2)
  );
  border-radius: 4px;
  box-shadow: 0 0 18px rgba(255,255,255,0.9);
  transform-origin: left center;
  width: 0;
  opacity: 0;
  transition:
    width 0.6s cubic-bezier(0.4, 0, 0.2, 1),
    opacity 0.4s ease;
  pointer-events: none;
}
.theme-switcher{position:fixed;top:10px;right:10px;display:flex;gap:.5rem}
.theme-btn{width:24px;height:24px;border-radius:50%;border:none;cursor:pointer}
body.purple{background:linear-gradient(270deg,#210034,#4a0089,#6a00b8)}
body.dark{background:linear-gradient(180deg,#000,#222)}
body.light{background:linear-gradient(180deg,#fff,#ccc);color:#111}
</style>
</head>

<body class="purple">

<div class="theme-switcher">
  <button class="theme-btn" style="background:#8B5CF6" onclick="setTheme('purple')"></button>
  <button class="theme-btn" style="background:#000" onclick="setTheme('dark')"></button>
  <button class="theme-btn" style="background:#fff" onclick="setTheme('light')"></button>
</div>

<div class="container">
  <div class="glass title">ðŸŽ® XO Arena Deluxe</div>

  <div class="glass panel">
    <button class="button" id="modeBtn">Mode: Single</button>
    <button class="button" id="levelBtn">AI: Easy</button>
    <button class="button" id="tourneyBtn">Tournament: Off</button>
  </div>

  <div class="glass board" id="board">
    <div id="win-line"></div>
  </div>

  <div class="glass panel">
    <div id="score">X:0 O:0</div>
    <button class="button" id="resetBtn">Reset Scores</button>
  </div>

  <div id="message">Tap to play!</div>
</div>

<script>
/* ---------- STATE ---------- */
let board=[],cells=[],player='x',mode='single',ai='easy',tourney=false;
let scores=JSON.parse(localStorage.getItem('xoScores')||'{"x":0,"o":0}');
const wins=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];

/* ---------- INIT ---------- */
const boardEl=document.getElementById('board');
const winLine=document.getElementById('win-line');
const msg=document.getElementById('message');
const scoreEl=document.getElementById('score');

function init(){
  board=Array(9).fill('');
  boardEl.innerHTML='<div id="win-line"></div>';
  boardEl.appendChild(winLine);
  for(let i=0;i<9;i++){
    const c=document.createElement('div');
    c.className='cell';
    c.onclick=()=>handleMove(i);
    boardEl.appendChild(c);
  }
  cells=[...document.querySelectorAll('.cell')];
  updateScore();
}

/* ---------- GAME FLOW ---------- */
function handleMove(i){
  if(board[i]||checkWinner(board))return;
  place(i,player);
  let w=checkWinner(board);
  if(w)return endGame(w);
  if(mode==='single'){
    player='o';
    setTimeout(aiMove,250);
  }else{
    player=player==='x'?'o':'x';
  }
}

function place(i,p){
  board[i]=p;
  cells[i].classList.add(p);
  cells[i].textContent=p.toUpperCase();
}

/* ---------- AI ---------- */
function aiMove(){
  if(checkWinner(board))return;
  let i;
  if(ai==='easy') i=randomEmpty();
  else if(ai==='medium') i=findWin('o')??findWin('x')??randomEmpty();
  else i=minimax(board,'o').index ?? randomEmpty();
  if(i==null)return;
  place(i,'o');
  let w=checkWinner(board);
  if(w)return endGame(w);
  player='x';
}

/* ---------- HELPERS ---------- */
function randomEmpty(){
  const e=board.map((v,i)=>v===''?i:null).filter(i=>i!=null);
  return e.length?e[Math.floor(Math.random()*e.length)]:null;
}
function findWin(sym){
  for(let [a,b,c] of wins){
    if(board[a]===sym&&board[b]===sym&&board[c]==='')return c;
    if(board[a]===sym&&board[c]===sym&&board[b]==='')return b;
    if(board[b]===sym&&board[c]===sym&&board[a]==='')return a;
  }
  return null;
}
function checkWinner(b){
  for(let [a,b1,c] of wins){
    if(b[a]&&b[a]===b[b1]&&b[a]===b[c])return[a,b1,c];
  }
  return b.includes('')?null:'draw';
}

/* ---------- END GAME ---------- */
function endGame(result) {
  if (result === 'draw') {
    msg.textContent = 'Draw!';
    return setTimeout(reset, 1200);
  }

  result.forEach(i => cells[i].classList.add('win'));
  drawWinLine(result);

  const winner = board[result[0]];
  msg.textContent = winner.toUpperCase() + ' wins!';
  scores[winner]++;
  saveScore();
  updateScore();

  setTimeout(() => {
    winLine.style.opacity = '0';
    reset();
  }, 1500);
}

  // Reset line
  winLine.style.transition = 'none';
  winLine.style.width = '0';
  winLine.style.opacity = '0';

  // Position line at start
  winLine.style.transform =
    `translate(${x1}px, ${y1}px) rotate(${angle}deg)`;

  // Force layout so transition works
  winLine.getBoundingClientRect();

  // Animate
  winLine.style.transition =
    'width 0.6s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.4s ease';
  winLine.style.width = `${length}px`;
  winLine.style.opacity = '1';
}

/* ---------- SCORE ---------- */
function updateScore(){scoreEl.textContent=`X:${scores.x} O:${scores.o}`}
function saveScore(){localStorage.setItem('xoScores',JSON.stringify(scores))}

/* ---------- MINIMAX ---------- */
function minimax(b,p){
  let w=checkWinner(b);
  if(w==='draw')return{score:0};
  if(w&&b[w[0]]==='x')return{score:-10};
  if(w&&b[w[0]]==='o')return{score:10};
  let m=[];
  b.forEach((v,i)=>{
    if(v===''){
      b[i]=p;
      let s=minimax(b,p==='o'?'x':'o').score;
      m.push({index:i,score:s});
      b[i]='';
    }
  });
  return p==='o'?m.reduce((a,b)=>b.score>a.score?b:a):m.reduce((a,b)=>b.score<a.score?b:a);
}

/* ---------- UI ---------- */
document.getElementById('modeBtn').onclick=()=>{mode=mode==='single'?'multi':'single';init();}
document.getElementById('levelBtn').onclick=()=>{ai=['easy','medium','hard'][( ['easy','medium','hard'].indexOf(ai)+1)%3];document.getElementById('levelBtn').textContent=`AI: ${ai.charAt(0).toUpperCase()+ai.slice(1)}`;init();}
document.getElementById('tourneyBtn').onclick=()=>{tourney=!tourney;init();}
document.getElementById('resetBtn').onclick=()=>{scores={x:0,o:0};saveScore();updateScore();}

function setTheme(t){document.body.className=t;localStorage.setItem('xoTheme',t)}
setTheme(localStorage.getItem('xoTheme')||'purple');

init();
</script>

<script>
if("serviceWorker"in navigator){
  window.addEventListener("load",()=>navigator.serviceWorker.register("service-worker.js"));
}
</script>

</body>
</html>
