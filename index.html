<!DOCTYPE html><!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>XO Arena Deluxe</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#6a00b8">

<style>
html,body{
  margin:0;padding:0;height:100%;
  font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
  display:flex;justify-content:center;align-items:center;
  background:#210034;color:#fff;overflow:hidden;
}

.container{width:100%;max-width:420px;padding:1rem;display:flex;flex-direction:column;gap:1rem}
.glass{background:rgba(255,255,255,.12);backdrop-filter:blur(14px);border-radius:16px;padding:1rem;box-shadow:0 6px 30px rgba(0,0,0,.35)}
.title{text-align:center;font-size:1.9rem;font-weight:700}

.controls{display:flex;gap:.5rem}
.controls button{flex:1}

.board-wrap{position:relative}
.board{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:.6rem;
}

.cell{
  aspect-ratio:1;
  border-radius:14px;
  background:rgba(255,255,255,.15);
  display:flex;align-items:center;justify-content:center;
  font-size:2.6rem;font-weight:800;
  cursor:pointer;
  transition:.25s;
}

.cell.x{color:#ff5cf4;text-shadow:0 0 14px #ff5cf4}
.cell.o{color:#00f5ff;text-shadow:0 0 14px #00f5ff}
.cell.win{box-shadow:0 0 18px rgba(255,255,255,.9)}

#win-line{
  position:absolute;
  height:5px;
  background:linear-gradient(90deg,rgba(255,255,255,.2),rgba(255,255,255,1),rgba(255,255,255,.2));
  border-radius:6px;
  box-shadow:0 0 20px rgba(255,255,255,.9);
  width:0;
  opacity:0;
  transform-origin:left center;
  transition:width .6s ease, opacity .3s ease;
  pointer-events:none;
}

button{
  border:none;border-radius:10px;
  padding:.45rem;
  font-weight:600;
  cursor:pointer;
}

.footer{display:flex;justify-content:space-between;align-items:center}
.message{text-align:center;font-size:1rem}

.theme-switch{
  position:fixed;top:12px;right:12px;
  display:flex;gap:.5rem;
}
.theme-switch button{
  width:26px;height:26px;border-radius:50%;
}

body.purple{background:linear-gradient(270deg,#210034,#4a0089,#6a00b8)}
body.dark{background:linear-gradient(180deg,#000,#222)}
body.light{background:linear-gradient(180deg,#fff,#ccc);color:#111}
</style>
</head>

<body class="purple">

<div class="theme-switch">
  <button style="background:#8b5cf6" onclick="setTheme('purple')"></button>
  <button style="background:#000" onclick="setTheme('dark')"></button>
  <button style="background:#fff" onclick="setTheme('light')"></button>
</div>

<div class="container">
  <div class="glass title">ðŸŽ® XO Arena Deluxe</div>

  <div class="glass controls">
    <button id="modeBtn">Mode: Single</button>
    <button id="levelBtn">AI: Easy</button>
    <button id="tourBtn">Tournament: Off</button>
  </div>

  <div class="glass board-wrap">
    <div class="board" id="board"></div>
    <div id="win-line"></div>
  </div>

  <div class="glass footer">
    <div id="score">X:0 O:0</div>
    <button onclick="resetScores()">Reset Scores</button>
  </div>

  <div class="message" id="msg">Tap to play!</div>
</div>

<script>
/* ========= STATE ========= */
let board, cells, player='x';
let mode='single', ai='easy', tournament=false;
let scores=JSON.parse(localStorage.getItem('xoScores')||'{"x":0,"o":0}');
const wins=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];

const boardEl=document.getElementById('board');
const winLine=document.getElementById('win-line');
const msg=document.getElementById('msg');
const scoreEl=document.getElementById('score');

/* ========= INIT ========= */
function init(){
  board=Array(9).fill('');
  boardEl.innerHTML='';
  winLine.style.opacity=0;
  winLine.style.width='0';

  for(let i=0;i<9;i++){
    const c=document.createElement('div');
    c.className='cell';
    c.onclick=()=>play(i);
    boardEl.appendChild(c);
  }
  cells=[...document.querySelectorAll('.cell')];
  updateScore();
}
init();

/* ========= GAME ========= */
function play(i){
  if(board[i]||check())return;
  place(i,'x');
  let w=check();
  if(w)return end(w);

  if(mode==='single'){
    setTimeout(aiMove,250);
  }
}

function place(i,p){
  board[i]=p;
  cells[i].classList.add(p);
  cells[i].textContent=p.toUpperCase();
}

function aiMove(){
  if(check())return;
  let i;
  if(ai==='easy') i=random();
  else if(ai==='medium') i=winFor('o')??winFor('x')??random();
  else i=minimax(board,'o').index ?? random();

  if(i==null)return;
  place(i,'o');
  let w=check();
  if(w)return end(w);
}

function random(){
  const e=board.map((v,i)=>v===''?i:null).filter(i=>i!=null);
  return e.length?e[Math.floor(Math.random()*e.length)]:null;
}

function winFor(sym){
  for(let [a,b,c] of wins){
    if(board[a]===sym&&board[b]===sym&&board[c]==='')return c;
    if(board[a]===sym&&board[c]===sym&&board[b]==='')return b;
    if(board[b]===sym&&board[c]===sym&&board[a]==='')return a;
  }
  return null;
}

function check(){
  for(let w of wins){
    if(board[w[0]]&&board[w[0]]===board[w[1]]&&board[w[0]]===board[w[2]])return w;
  }
  return board.includes('')?null:'draw';
}

/* ========= END ========= */
function end(res){
  if(res==='draw'){
    msg.textContent='Draw!';
    return setTimeout(init,1200);
  }

  res.forEach(i=>cells[i].classList.add('win'));
  drawLine(res);

  scores[board[res[0]]]++;
  localStorage.setItem('xoScores',JSON.stringify(scores));
  updateScore();
  msg.textContent=board[res[0]].toUpperCase()+' wins';

  setTimeout(init,1500);
}

/* ========= WIN LINE ========= */
function drawLine([a,_,c]){
  const r1=cells[a].getBoundingClientRect();
  const r2=cells[c].getBoundingClientRect();
  const br=boardEl.getBoundingClientRect();

  const x1=r1.left-br.left+r1.width/2;
  const y1=r1.top-br.top+r1.height/2;
  const x2=r2.left-br.left+r2.width/2;
  const y2=r2.top-br.top+r2.height/2;

  const len=Math.hypot(x2-x1,y2-y1);
  const ang=Math.atan2(y2-y1,x2-x1)*180/Math.PI;

  winLine.style.transform=`translate(${x1}px,${y1}px) rotate(${ang}deg)`;
  winLine.style.width='0';
  winLine.style.opacity=1;
  requestAnimationFrame(()=>winLine.style.width=len+'px');
}

/* ========= MINIMAX ========= */
function minimax(b,p){
  let w=check();
  if(w==='draw')return{score:0};
  if(w&&b[w[0]]==='x')return{score:-10};
  if(w&&b[w[0]]==='o')return{score:10};

  let moves=[];
  b.forEach((v,i)=>{
    if(v===''){
      b[i]=p;
      let s=minimax(b,p==='o'?'x':'o').score;
      moves.push({index:i,score:s});
      b[i]='';
    }
  });
  return p==='o'
    ?moves.reduce((a,b)=>b.score>a.score?b:a)
    :moves.reduce((a,b)=>b.score<a.score?b:a);
}

/* ========= UI ========= */
function updateScore(){scoreEl.textContent=`X:${scores.x} O:${scores.o}`}
function resetScores(){scores={x:0,o:0};localStorage.setItem('xoScores',JSON.stringify(scores));updateScore();}

document.getElementById('modeBtn').onclick=()=>{
  mode=mode==='single'?'multi':'single';
  document.getElementById('modeBtn').textContent=`Mode: ${mode==='single'?'Single':'Multi'}`;
  init();
};

document.getElementById('levelBtn').onclick=()=>{
  ai=['easy','medium','hard'][( ['easy','medium','hard'].indexOf(ai)+1)%3];
  document.getElementById('levelBtn').textContent=`AI: ${ai.charAt(0).toUpperCase()+ai.slice(1)}`;
  init();
};

document.getElementById('tourBtn').onclick=()=>{
  tournament=!tournament;
  document.getElementById('tourBtn').textContent=`Tournament: ${tournament?'On':'Off'}`;
  init();
};

function setTheme(t){document.body.className=t;localStorage.setItem('xoTheme',t)}
setTheme(localStorage.getItem('xoTheme')||'purple');
</script>

<script>
if('serviceWorker'in navigator){
  window.addEventListener('load',()=>navigator.serviceWorker.register('service-worker.js'));
}
</script>

</body>
</html>
